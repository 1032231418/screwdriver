#!/usr/bin/env node
'use strict';

const winston = require('winston');
const path = require('path');
const inMemoryDatastore = require('screwdriver-datastore-imdb');

const jwtPrivateKey = process.env.SECRET_JWT_PRIVATE_KEY;
const oauthClientId = process.env.SECRET_OAUTH_CLIENT_ID;
const oauthClientSecret = process.env.SECRET_OAUTH_CLIENT_SECRET;
const password = process.env.SECRET_PASSWORD;
const https = process.env.IS_HTTPS || false;

require('../')({
    port: process.env.PORT || 8080,
    datastore: new inMemoryDatastore({
        filename: path.join(process.env.DATA_DIR || process.cwd(), '/database.json')
    }),
    'screwdriver-plugin-login': {
        https,
        jwtPrivateKey,
        oauthClientId,
        oauthClientSecret,
        password
    }
}, (err, server) => {
    if (err) {
        winston.error(err);

        return process.exit(1);
    }

    return winston.info('Server running at %s', server.info.uri);
});
